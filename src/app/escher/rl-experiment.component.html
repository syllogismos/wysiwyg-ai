<div class="row">
  <div class="col-12 col-md-12 col-xl-8">
    <div class="widget">
      <div class="row">
        <div class="col">
          <h5><b>Experiment Details:</b> {{experiment.name}}</h5>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">Environment Settings</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Environment Name</td>
                      <td>{{experiment.config.env_name}}</td>
                    </tr>
                    <tr>
                      <td>Observation Space</td>
                      <td>{{env_data?.observation_space}}</td>
                    </tr>
                    <tr>
                      <td>Action Space</td>
                      <td>{{env_data?.action_space}}</td>
                    </tr>
                    <tr>
                      <td>Target Return</td>
                      <td>{{env_data?.reward_threshold}}</td>
                    </tr>
                    <tr>
                      <td>Max Episode Length</td>
                      <td>{{env_data?.timestep_limit}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">Policy Network</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Policy hidden sizes</td>
                      <td>{{experiment.config.policy_hidden_sizes}}</td>
                    </tr>
                    <tr>
                      <td>Policy Actiavtion</td>
                      <td>{{experiment.config.policy_hidden_nonlinearity}}</td>
                    </tr>
                    <tr>
                      <td>Policy Output Activation</td>
                      <td>{{experiment.config.policy_output_nonlinearity}}</td>
                    </tr>
                    <tr>
                      <td>Policy Batch Size</td>
                      <td>{{experiment.config.form_params.var_policy_batch_size}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">EC2 Settings</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Machine Type</td>
                      <td>{{experiment.config.machine_type}}</td>
                    </tr>
                    <tr>
                      <td>Current Spot Price</td>
                      <td>$0.4</td>
                    </tr>
                    <tr>
                      <td>No. of vcpu</td>
                      <td>4</td>
                    </tr>
                    <tr>
                      <td>Memory</td>
                      <td>4</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">Algorithm Settings</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Algorithm Name</td>
                      <td>{{experiment.config.algo_name}}</td>
                    </tr>
                    <tr>
                      <td>Learning Rate</td>
                      <td>{{experiment.config.form_params.var_learning_rate}}</td>
                    </tr>
                    <tr>
                      <td>Step Size</td>
                      <td>{{experiment.config.form_params.var_step_size}}</td>
                    </tr>
                    <tr>
                      <td>GAE Lambda</td>
                      <td>{{experiment.config.form_params.var_gae_lambda}}</td>
                    </tr>
                    <tr>
                      <td>Scale Reward</td>
                      <td>{{experiment.config.form_params.var_scale_reward}}</td>
                    </tr>
                    <tr>
                      <td>Replay Pool Size</td>
                      <td>{{experiment.config.form_params.var_replay_pool_size}}</td>
                    </tr>
                    <tr>
                      <td>Batch Size</td>
                      <td>{{experiment.config.form_params.var_batch_size}}</td>
                    </tr>
                    <tr>
                      <td>Discount</td>
                      <td>{{experiment.config.form_params.var_discount}}</td>
                    </tr>
                    <tr>
                      <td>No of Episodes</td>
                      <td>{{experiment.config.max_episode}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">Baseline Network</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Baseline hidden sizes</td>
                      <td>{{experiment.config.baseline_hidden_sizes}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="table-responsive">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th colspan="2">QF Network</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>QF hidden sizes</td>
                      <td>{{experiment.config.qf_hidden_sizes}}</td>
                    </tr>
                    <tr>
                      <td>QF Activation</td>
                      <td>{{experiment.config.qf_hidden_nonlinearity}}</td>
                    </tr>
                    <tr>
                      <td>QF Batch Size</td>
                      <td>{{experiment.config.form_params.var_qf_batch_size}}</td>
                    </tr>
                    <tr>
                      <td>QF Learning Rate</td>
                      <td>{{experiment.config.form_params.var_qf_learning_rate}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-12 col-xl-4">
    <div class="row">
      <div class="widget">
        <div class="row">
          <div class="col-4">
            <button class="btn btn-default" (click)="relaunchExperiment()">Relaunch</button>
          </div>
          <!-- <div class="col-3">
            <button class="btn btn-warning" (click)="refreshTimeline()">Refresh</button>
          </div> -->
          <div class="col-4">
            <button class="btn btn-primary" (click)="startIntroJS()">Walkthrough</button>
          </div>
        </div>
        <hr>
        <div id="step1" class="row">
          <div class="col">
            <div class="dropdown pull-right">
              <button type="button" class="btn btn-default btn-rounded btn-outline dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="variant-dropdown">
                Select Variant
              </button>
              <div class="dropdown-menu dropdown-menu-right from-right">
                <a *ngFor="let variant of variants" (click)="modifyTimeline(variant)" class="dropdown-item">Variant: {{variant}}</a>
                <a (click)="allVariantsTimeline()" class="dropdown-item">All Variants</a>
              </div>
            </div>
            <div class="title">Experiment timeline</div>
            <!-- <div class="description">Recent experiment Activity</div> -->
            <div *ngIf="selectedTimelineVariant=='all'; then thenTimelineBlock else elseTimelineBlock" class="description"></div>
            <ng-template #thenTimelineBlock>
              <div>All Variants Activity</div>
            </ng-template>
            <ng-template #elseTimelineBlock>
              <div>Variant: {{selectedTimelineVariant}} Activity</div>
            </ng-template>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="timeline-widget-1">
              <div *ngFor="let timeline_log of exp_timeline" class="row justify-content-start align-items-center timeline-{{timeline_log._source.json.timeline.level}}">
                <div class="col">
                  <div class="timeline-item">
                    <p>{{timeline_log.moment}}</p>
                    <p>{{timeline_log._source.json.timeline.message}}</p>
                  </div>
                </div>
              </div>
              <!-- <div class="row justify-content-start align-items-center timeline-warning">
                <div class="col">
                  <div class="timeline-item">
                    <p>10 minutes ago</p>
                    <p>Manually terminated the run on Variant id: 9hoq31</p>
                    <div class="actions">
                            <span>Reply</span>
                            <i class="fa fa-mail-reply"></i>
                          </div>
                  </div>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<hr>
<div id="step2" class="row">
  <div class="col">
    <div class="widget">
      <div class="row">
        <div class="col">
          <h5>Variant Settings</h5>
        </div>
      </div>
      <div class="table-responsive">
        <table id="variants-table" class="table table-hover table-bordered">
          <thead>
            <tr>
              <th>Variant</th>
              <th>Seed</th>
              <th>QF Batch Size</th>
              <th>Policy Batch Size</th>
              <th>QF LR</th>
              <th>Replay Pool</th>
              <th>Scale Reward</th>
              <th>Step Size</th>
              <th>GAE Lambda</th>
              <th>LR</th>
              <th>Discount</th>
              <th>Batch Size</th>
              <!-- <th>Progress</th> -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let variant of experiment.config.variants; index as i">
              <td>{{i}}</td>
              <td>{{variant.seed}}</td>
              <td>{{variant.qf_batch_size}}</td>
              <td>{{variant.policy_batch_size}}</td>
              <td>{{variant.qf_learning_rate}}</td>
              <td>{{variant.replay_pool_size}}</td>
              <td>{{variant.scale_reward}}</td>
              <td>{{variant.step_size}}</td>
              <td>{{variant.gae_lambda}}</td>
              <td>{{variant.learning_rate}}</td>
              <td>{{variant.discount}}</td>
              <td>{{variant.batch_size}}</td>
              <!-- <td>
                <div class="progress progress-sm">
                  <div class="progress-bar bg-secondary" role="progressbar" style="width: 33%" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<hr>

<!-- <div class="row">
  <div class="col">
    <div class="widget">
      <div class="row">
        <h5>Variants Progress:</h5>
      </div>
      <div class="row">
        <div class="col">
          <div class="easy-pie-chart-xs easy-pie-chart">
            <div class="chart easy-pie-chart-primary-xs" data-percent="63"></div>
            <span class="number color-primary">83%</span>
          </div>
        </div>
        <div class="col">
          <div class="easy-pie-chart-xs easy-pie-chart">
            <div class="chart easy-pie-chart-primary-xs" data-percent="45"></div>
            <span class="number color-primary">74%</span>
          </div>
        </div>
        <div class="col">
          <div class="easy-pie-chart-xs easy-pie-chart">
            <div class="chart easy-pie-chart-primary-xs" data-percent="53"></div>
            <span class="number color-primary">69%</span>
          </div>
        </div>
        <div class="col">
          <div class="easy-pie-chart-xs easy-pie-chart">
            <div class="chart easy-pie-chart-danger-xs" data-percent="37"></div>
            <span class="number color-danger">37%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->



<div class="row">
  <div class="col">
    <div class="widget">
      <div class="row">
        <div class="col">
          <h4>Results and Plots</h4>
        </div>
      </div>
      <div id="step3" class="row">
        <!-- <div class="col-3">
          <div class="title">Metric</div>
        </div> -->
        <div class="col-3">
          <div class="title">
            Selected Metric:
          </div>
          <div class="description">
            {{selectedMetric}}
          </div>
        </div>
        <div class="col-5"></div>
        <div class="col-2">
          <button class="btn btn-warning pull-right" (click)="refreshData()">Refresh</button>            
        </div>
        <div class="col-2">
          <div class="dropdown pull-right">
            <button type="button" class="btn btn-default btn-rounded btn-outline dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              Select Metric
            </button>
            <div class="dropdown-menu dropdown-menu-right from-right">
              <a *ngFor="let metric of metrics" (click)="modifyD3Table(metric)" class="dropdown-item">{{metric}}</a>
              <!-- <a class="dropdown-item">id: r34t34</a>
                <a class="dropdown-item">id: dfa87l</a>
                <a class="dropdown-item">id: amn071</a> -->
            </div>
          </div>
        </div>
        <!-- <div class="col-3">
          <select class="form-control" id="metric-select">
            <option *ngFor="let metric of metrics" [value]="metric">{{metric}}</option>
          </select>
        </div> -->
      </div>
      <div class="row">
        <div class="col">
          <div id="nvd3-metric">
            <svg style="height:400px;width:100%"></svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <div class="widget">
      <div class="row">
        <div class="col-3">
          <div class="title">
            Selected Variant:
          </div>
          <div *ngIf="selectedVariant=='all'; then thenBlock else elseBlock" class="description">
          </div>
          <ng-template #thenBlock>
            <div>All Variants</div>
          </ng-template>
          <ng-template #elseBlock>
            <div>Variant: {{selectedVariant}}</div>
          </ng-template>
        </div>
        <div class="col">
          <div class="dropdown pull-right">
            <button type="button" class="btn btn-default btn-rounded btn-outline dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              Select Variant
            </button>
            <div class="dropdown-menu dropdown-menu-right from-right">
              <a *ngFor="let variant of variants" (click)="modifyDataTable(variant)" class="dropdown-item">Variant: {{variant}}</a>
              <a (click)="allVariantsDataTable()" class="dropdown-item">All Variants</a>
              <!-- <a class="dropdown-item">id: r34t34</a>
              <a class="dropdown-item">id: dfa87l</a>
              <a class="dropdown-item">id: amn071</a> -->
            </div>
          </div>
        </div>
        <!-- <div class="col-3">
          <select id="variant-select" class="form-control">
            <option *ngFor="let variant of variants" [value]="variant">Variant: {{variant}}</option>
          </select>
        </div> -->
      </div>
      <div class="row">
        <div class="col">
          <table id="exp-logs-datatable" class="table table-hover table-striped table-bordered" style="width: 100%">
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<hr>
<div class="row">
  <div class="col">
    <div class="widget">
      <div id="step4" class="row">
        <div class="col-8">
          <h4>Debugging</h4>
          <div class="description">Variant: <b>{{selectedDebuggingVariant}}</b>, {{variantsData[selectedDebuggingVariant].iteration}} Iterations. Select an iteration using the slider to see the trained agent.</div>
        </div>
        <div class="col-4">
          <div class="dropdown pull-right">
            <button type="button" class="btn btn-default btn-rounded btn-outline dropdown-toggle" data-toggle="dropdown" aira-haspopup="true" aria-expanded="false">
              Select Variant
            </button>
            <div class="dropdown-menu dropdown-menu-right from-right">
              <a *ngFor="let variant of variants" (click)="debugVariant(variant)" class="dropdown-item">Variant: {{variant}}</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-1">
          <label class="title">Iteration: </label>
        </div>
        <div class="col-5">
          <div id="debug-variant-slider" class="slider-primary"></div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <video [src]="variantIterationVideoSrc" width="600" height="400" controls>
            <!-- <source src="https://s3.amazonaws.com/karaka_test/5a4b9c9108d1a338d21d38ef/0/escher/rl_exp/gym_log/openaigym.video.0.1.video000022.mp4" type="video/mp4"> -->
            <!-- <source src="variantIterationVideoSrc" type="video/mp4"> -->
          </video>
          <!-- <img src="{{ angularLogo }}">
          <img [src]="angularLogo">
          <img bind-src="angularLogo"> -->
        </div>
      </div>
    </div>
  </div>
</div>
<hr>
<app-exp-cpu-plots [experiment]="experiment_id"></app-exp-cpu-plots>
<br>
<br>
<br>
<br>